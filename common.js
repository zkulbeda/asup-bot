import firestore from "@google-cloud/firestore";
import cloud_key from './bot_credentials.json'

export let db = new firestore({
    credentials: cloud_key
});
export let hello_message = "*–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ –±–æ—Ç —à–∫–æ–ª—å–Ω–æ–π —Å—Ç–æ–ª–æ–≤–æ–π —à–∫–æ–ª—ã ‚Ññ1 –≥. –î—Ä–æ–≥–∏—á–∏–Ω–∞.*\n" +
    "–Ø –±—É–¥—É –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–µ–±—è –∫–∞–∂–¥—ã–π –±—É–¥–Ω–∏–π –¥–µ–Ω—å, –±—É–¥–µ—à—å –ª–∏ —Ç—ã –∫—É—à–∞—Ç—å. " +
    "–í–æ–∑–º–æ–∂–Ω–æ –∏–Ω–æ–≥–¥–∞ –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∫–æ–ª–µ.";
export let command_list = "–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:\n" +
    "/setting - –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n" +
    "/contact - –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã —à–∫–æ–ª—ã\n" +
    "/help - –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥\n";
export let messages = {
    hello_message: {
        vk: [
            "–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ –±–æ—Ç —à–∫–æ–ª—å–Ω–æ–π —Å—Ç–æ–ª–æ–≤–æ–π —à–∫–æ–ª—ã ‚Ññ1 –≥. –î—Ä–æ–≥–∏—á–∏–Ω–∞.\n" +
            "–Ø –±—É–¥—É –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ç–µ–±—è –∫–∞–∂–¥—ã–π –±—É–¥–Ω–∏–π –¥–µ–Ω—å, –±—É–¥–µ—à—å –ª–∏ —Ç—ã –∫—É—à–∞—Ç—å. " +
            "–í–æ–∑–º–æ–∂–Ω–æ –∏–Ω–æ–≥–¥–∞ –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —à–∫–æ–ª–µ."
        ]
    },
    start_bot_without_code: {
        vk: [
            "{{'hello_message'|render}}\n\n–û—Ç–ø—Ä–∞–≤—å —Å–≤–æ–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, —á—Ç–æ–±—ã —è –∑–Ω–∞–ª, –∫—Ç–æ –∂–µ —Ç—ã —Ç–∞–∫–æ–π.",
        ],
        tg: [
            "{{'hello_message'|render}}\n\n*–û—Ç–ø—Ä–∞–≤—å —Å–≤–æ–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è, —á—Ç–æ–±—ã —è –∑–Ω–∞–ª, –∫—Ç–æ –∂–µ —Ç—ã —Ç–∞–∫–æ–π.*"
        ]
    },
    help_with_invitation_code: [
        "–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —É —Å–≤–æ–µ–≥–æ –∫–ª–∞—Å—Å–Ω–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è. " +
        "–û–Ω –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –¥–≤–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å–ª–æ–≤–∞ –∏ —á–∏—Å–ª–æ. –û–Ω–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã —Å –ø–æ–º–æ—â—å—é –¥–µ—Ñ–∏—Å–∞.\n–ù–∞–ø—Ä–∏–º–µ—Ä, –≤–æ—Ç –∫–∞–∫ –æ–Ω –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å: test-code-72"
    ],
    code_not_found: {
        tg: [
            "*–ù–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ —Ç–∞–∫–æ–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è...*\n\n–ü—Ä–æ–≤–µ—Ä—å –µ–≥–æ –Ω–∞ –æ—à–∏–±–∫–∏ " +
            "–∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ —Å–≤–æ–µ–º—É –∫–ª–∞—Å—Å–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é."
        ],
        vk: [
            "–ù–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ —Ç–∞–∫–æ–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è...\n\n–ü—Ä–æ–≤–µ—Ä—å –µ–≥–æ –Ω–∞ –æ—à–∏–±–∫–∏ " +
            "–∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Å—å –∫ —Å–≤–æ–µ–º—É –∫–ª–∞—Å—Å–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é."
        ]
    },
    help_with_invitation_code_button_label: "–£ –º–µ–Ω—è –Ω–µ—Ç –∫–æ–¥–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è",
    success_code: [
        "–û—Ç–ª–∏—á–Ω–æ! üéâ\n–¢–µ–ø–µ—Ä—å —è –∑–Ω–∞—é, —á—Ç–æ —Ç—ã ‚Äî {{last_name}} {{first_name}}.\n" + //TODO –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–º–∞–π–ª ü•≥
        '–í—Å–µ –≥–æ—Ç–æ–≤–æ, –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–π –º–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.'
    ],
    settings_first_message: [
        "–ß—Ç–æ –∂–µ —Ç—ã –∂–µ–ª–∞–µ—à—å —Å–¥–µ–ª–∞—Ç—å?"
    ],
    send_questions_button: [
        "{{'–•' if send else '–ù–µ —Ö'}}–æ—á—É –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
    ],
    dont_send_questions_answer: {
        tg: [
            "–•–æ—Ä–æ—à–æ, —Ç–µ–ø–µ—Ä—å —Ç–µ–±–µ –ø—Ä–∏–¥–µ—Ç—Å—è *—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ* —Å–æ–æ–±—â–∞—Ç—å, –∫–æ–≥–¥–∞ —Ç—ã —Ö–æ—á–µ—à—å –∫—É—à–∞—Ç—å. " +
            "\n–î–ª—è —ç—Ç–æ–≥–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ \"*–Ø –±—É–¥—É –∫—É—à–∞—Ç—å*\".\n{{'something_more'|render}}"
        ],
        vk: [
            "–•–æ—Ä–æ—à–æ, —Ç–µ–ø–µ—Ä—å —Ç–µ–±–µ –ø—Ä–∏–¥–µ—Ç—Å—è –°–ê–ú–û–°–¢–û–Ø–¢–ï–õ–¨–ù–û —Å–æ–æ–±—â–∞—Ç—å, –∫–æ–≥–¥–∞ —Ç—ã —Ö–æ—á–µ—à—å –∫—É—à–∞—Ç—å. " +
            "\n–î–ª—è —ç—Ç–æ–≥–æ –æ—Ç–ø—Ä–∞–≤—å –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–µ \"–Ø –±—É–¥—É –∫—É—à–∞—Ç—å\".\n{{'something_more'|render}}"
        ]
    },
    send_questions_answer: [
        "–•–æ—Ä–æ—à–æ, —Ç–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –±—É–¥–Ω–∏–π –¥–µ–Ω—å —è —Ç–µ–±–µ –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º.\n{{'something_more'|render}}"
    ],
    something_more: [
        "–ú–æ–∂–µ—Ç —á—Ç–æ-–Ω–∏–±—É–¥—å –µ—â–µ?",
        "–ñ–µ–ª–∞–µ—à—å —Å–¥–µ–ª–∞—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å –µ—â–µ?"
    ],
    settings_closed: [
        '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã'
    ],
    no_menu: [
        "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–≥–æ–¥–Ω—è –º–µ–Ω—é –Ω–µ —É–∫–∞–∑–∞–Ω–æ.",
        "–ú–µ–Ω—é –Ω–µ —É–∫–∞–∑–∞–Ω–æ. üåö",
        "–ö–∞–∂–µ—Ç—Å—è –º–µ–Ω—é –∑–∞–±—ã–ª–∏ —É–∫–∞–∑–∞—Ç—å. üòß",
    ],
    question: {
        vk: "{{'eating_question'|render}}\n\n" +
            "{{'today_in_dining_room'|render}}\n" +
            "{{menu}}",
        tg: "*{{'eating_question'|render}}*\n\n" +
            "*{{'today_in_dining_room'|render}}*\n" +
            "{{menu}}"
    },
    edited_question: {
        vk: "{{'your_answer'|render}} {{('i_want_eat' if will_eat else 'i_dont_want_eat')|render}}.\n\n" +
            "{{'today_in_dining_room'|render}}\n" +
            "{{menu}}",
        tg: "{{('i_want_eat_thanks' if will_eat else 'i_dont_want_eat_okay')|render}}\n\n" +
            "*–¢—ã –µ—â–µ –º–æ–∂–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å —Å–≤–æ–π –≤—ã–±–æ—Ä.*\n" +
            "*{{'today_in_dining_room'|render}}*\n" +
            "{{menu}}"
    },
    stopped_poll_question: {
        tg: "*{{'your_answer'|render}} {{('i_want_eat' if will_eat else 'i_dont_want_eat')|render}}.*\n\n" +
            "*{{'today_in_dining_room'|render}}*\n" +
            "{{menu}}",
    },
    your_answer: [
        "–¢–≤–æ–π –æ—Ç–≤–µ—Ç:",
        "–¢–≤–æ–π –≤—ã–±–æ—Ä:"
    ],
    i_want_eat: [
        "—è –±—É–¥—É –µ—Å—Ç—å",
        "—è –±—É–¥—É –∫—É—à–∞—Ç—å",
        "—è –ø–∏—Ç–∞—é—Å—å —Å–µ–≥–æ–¥–Ω—è",
        "—è —Å–µ–≥–æ–¥–Ω—è –µ–º",
    ],
    i_dont_want_eat: [
        "—è –Ω–µ –±—É–¥—É –µ—Å—Ç—å",
        "—è –Ω–µ –±—É–¥—É –∫—É—à–∞—Ç—å",
        "—è –Ω–µ –ø–∏—Ç–∞—é—Å—å —Å–µ–≥–æ–¥–Ω—è",
        "—è —Å–µ–≥–æ–¥–Ω—è –Ω–µ –µ–º",
    ],
    i_want_eat_thanks: [
        "–û—Ç–ª–∏—á–Ω–æ, –ø—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞üëåüèª"
    ],
    i_dont_want_eat_okay: [
        "–•–æ—Ä–æ—à–æ, —Å–ø–∞—Å–∏–±–æ –∑–∞ —Ç–≤–æ–π –æ—Ç–≤–µ—Ç üë©üèª‚Äçüç≥"
    ],
    i_want_eat_button: "{{'i_want_eat'|render|capitalize_first}}",
    i_dont_want_eat_button: "–ù–µ—Ç, {{'i_dont_want_eat'|render}}",
    today_in_dining_room: [
        "–°–µ–≥–æ–¥–Ω—è –≤ —Å—Ç–æ–ª–æ–≤–æ–π:",
        "–í —Å—Ç–æ–ª–æ–≤–æ–π —Å–µ–≥–æ–¥–Ω—è:",
        "–í –º–µ–Ω—é —Å–µ–≥–æ–¥–Ω—è:",
        "–°–µ–≥–æ–¥–Ω—è —Å—Ç–æ–ª–æ–≤–∞—è –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç:"
    ],
    eating_question: [
        '–ü—Ä–∏–≤–µ—Ç, —Ç—ã –±—É–¥–µ—à—å —Å–µ–≥–æ–¥–Ω—è –ø–∏—Ç–∞—Ç—å—Å—è?',
        "–ü—Ä–∏–≤–µ—Ç, –Ω–µ —Ö–æ—á–µ—à—å –ø–æ–¥–∫—Ä–µ–ø–∏—Ç—å—Å—è?"
    ],
    ok_you_will_eat_today: [
        "–•–æ—Ä–æ—à–æ, —Ç—ã –∫—É—à–∞–µ—à—å —Å–µ–≥–æ–¥–Ω—è.",
        "–û—Ç–ª–∏—á–Ω–æ, –±—É–¥—É –∑–Ω–∞—Ç—å, —á—Ç–æ —Ç—ã –ø–∏—Ç–∞–µ—à—å—Å—è —Å–µ–≥–æ–¥–Ω—èü§ó",
        "–•–æ—Ä–æ—à–æ, —è –ø–µ—Ä–µ–¥–∞–º —ç—Ç–æ –≤ —Å—Ç–æ–ª–æ–≤—É—éüòè",
        "–û–∫–µ–π, —Å–ø–∞—Å–∏–±–æ –∑–∞ —Ç–≤–æ–π –æ—Ç–≤–µ—ÇüôÇ"
    ],
    ok_you_will_not_eat_today: [
        '–õ–∞–¥–Ω–æ, —Ç—ã –Ω–µ –∫—É—à–∞–µ—à—å —Å–µ–≥–æ–¥–Ω—è.',
        "–õ–∞–¥–Ω–æ, —è –ø–µ—Ä–µ–¥–∞–º –≤ —Å—Ç–æ–ª–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —ç—Ç–æ–ºüòü",
        "–•–æ—Ä–æ—à–æ, —è —Å–æ–æ–±—â—é –Ω–∞—à–µ–π —Å—Ç–æ–ª–æ–≤–æ–π –æ–± —ç—Ç–æ–π –ø–µ—á–∞–ª—å–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏üò≠"
    ],
    ok_you_will_eat_today_but_poll_isnt_active: [
        "–•–æ—Ä–æ—à–æ, –µ—Å–ª–∏ —Å—Ç–æ–ª–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–≥–æ–¥–Ω—è, –º—ã —Å–æ–æ–±—â–∏–º –µ–π –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –∫—É—à–∞–µ—à—å."
    ],
    ok_you_will_not_eat_today_but_poll_isnt_active: [
        "–•–æ—Ä–æ—à–æ, –µ—Å–ª–∏ —Å—Ç–æ–ª–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–≥–æ–¥–Ω—è, –º—ã —Å–æ–æ–±—â–∏–º –µ–π –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –Ω–µ –∫—É—à–∞–µ—à—å."
    ],
    you_already_will_eat_today: [
        "–î–∞, —è —É–∂–µ –∑–Ω–∞—é, —á—Ç–æ —Ç—ã –±—É–¥–µ—à—å –ø–∏—Ç–∞—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è"
    ],
    you_already_will_not_eat_today: [
        "–î–∞, —è —É–∂–µ –∑–Ω–∞—é, —á—Ç–æ —Ç—ã –Ω–µ –±—É–¥–µ—à—å –ø–∏—Ç–∞—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è"
    ],
    sorry_timeout: [
        "–ò–∑–≤–∏–Ω–∏, –Ω–æ —É–∂–µ —Å–≤–æ–π –≤—ã–±–æ—Ä –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ–ª—å–∑—è",
    ],
    sorry_you_re_late: {
        vk: "–¢—ã –æ–ø–æ–∑–¥–∞–ª –Ω–∞ –∑–∞–ø–∏—Å—å.\n" +
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ {{'–Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏ –Ω–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ' if notified else '–Ω–µ –∑–∞–±—ã–≤–∞–π —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –Ω–∞–º –æ —Å–≤–æ–∏—Ö –ø–ª–∞–Ω–∞—Ö'}}.",
        tg: "*–ò–∑–≤–∏–Ω–∏, —Ç—ã –æ–ø–æ–∑–¥–∞–ª –Ω–∞ –∑–∞–ø–∏—Å—å —Å–µ–≥–æ–¥–Ω—è.*\n" +
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ {{'–Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏ –Ω–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ' if notified else '–Ω–µ –∑–∞–±—ã–≤–∞–π —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –Ω–∞–º –æ —Å–≤–æ–∏—Ö –ø–ª–∞–Ω–∞—Ö'}}."
    },
    i_will_eat_anyway_button: {
        vk: "–ù–æ —è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–π–¥—É –µ—Å—Ç—å",
        tg: "–ù–æ —è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–π–¥—É –µ—Å—Ç—å"
    },
    i_will_eat_anyway_text: {
        vk: "–•–æ—Ä–æ—à–æ, –º—ã —É–≤–µ–¥–æ–º–∏–º —Å—Ç–æ–ª–æ–≤—É—é –æ —Ç–æ–º, —á—Ç–æ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –∫—É—à–∞—Ç—å.\n" +
            "–í–∞–∂–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –≤ –Ω–∞—á–∞–ª–µ –¥–Ω—è –æ —Ç–æ–º, —á—Ç–æ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –ø–∏—Ç–∞—Ç—å—Å—è. –ü–æ–≤–∞—Ä–∞ –ø—Ä–∏–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç –ø–æ—Ä—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è. " +
            "–í –æ–¥–∏–Ω –¥–µ–Ω—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫, —á—Ç–æ –ª–∏—à–Ω–∏—Ö –ø–æ—Ä—Ü–∏–π –ø—Ä–æ—Å—Ç–æ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∏ —Ç–µ–±–µ –ø—Ä–∏–¥–µ—Ç—Å—è –±—ã—Ç—å –±–µ–∑ –æ–±–µ–¥–∞.",
        tg: "*–•–æ—Ä–æ—à–æ, –º—ã —É–≤–µ–¥–æ–º–∏–º —Å—Ç–æ–ª–æ–≤—É—é –æ —Ç–æ–º, —á—Ç–æ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –∫—É—à–∞—Ç—å.*\n\n" +
            "–í–∞–∂–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –≤ –Ω–∞—á–∞–ª–µ –¥–Ω—è –æ —Ç–æ–º, —á—Ç–æ —Ç—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –ø–∏—Ç–∞—Ç—å—Å—è. –ü–æ–≤–∞—Ä–∞ –ø—Ä–∏–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç –ø–æ—Ä—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ–±—è. " +
            "–í –æ–¥–∏–Ω –¥–µ–Ω—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫, —á—Ç–æ –ª–∏—à–Ω–∏—Ö –ø–æ—Ä—Ü–∏–π –ø—Ä–æ—Å—Ç–æ –Ω–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∏ —Ç–µ–±–µ –ø—Ä–∏–¥–µ—Ç—Å—è –±—ã—Ç—å –±–µ–∑ –æ–±–µ–¥–∞."
    },
    you_did_not_record_yourself: {
        vk: "–¢—ã –ø–∏—Ç–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è.\n\n" + //TODO –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –µ—Å–ª–∏ —É—á–µ–Ω–∏–∫ –æ—Ç–≤–µ—Ç–∏–ª –ù–ï–¢
            "–¢–µ–±—è –Ω–µ –Ω–∞—à–ª–∏ –≤ –∑–∞–ø–∏—Å—è—Ö —Å—Ç–æ–ª–æ–≤–æ–π —Å–µ–≥–æ–¥–Ω—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, " +
            "{{'–Ω–µ –∑–∞–±—ã–≤–∞–π –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –º–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è' if notified else " +
            "'–Ω–µ –∑–∞–±—ã–≤–∞–π –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –ø–∏—Ç–∞–µ—à—å—Å—è —Å–µ–≥–æ–¥–Ω—è. –ò–ª–∏ —è –º–æ–≥—É –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å —Ç–µ–±–µ –æ–± —ç—Ç–æ–º.'}}. " +
            "–≠—Ç–æ –≤–∞–∂–Ω–æ.\n\n" +
            "–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, –æ–±—Ä–∞—Ç–∏—Å—å –∫ —Å–≤–æ–µ–º—É –∫–ª–∞—Å—Å–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é. " +
            "–í–æ–∑–º–æ–∂–Ω–æ, –∫—Ç–æ-—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–≤–æ–µ–π –∫–∞—Ä—Ç–æ–π –ø–∏—Ç–∞–Ω–∏—è.",
        tg: "*–¢—ã –ø–∏—Ç–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è.*\n\n" +
            "–¢–µ–±—è –Ω–µ –Ω–∞—à–ª–∏ –≤ –∑–∞–ø–∏—Å—è—Ö —Å—Ç–æ–ª–æ–≤–æ–π —Å–µ–≥–æ–¥–Ω—è. " +
            "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, " +
            "{{'–Ω–µ –∑–∞–±—ã–≤–∞–π –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –º–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è' if notified else " +
            "'–Ω–µ –∑–∞–±—ã–≤–∞–π –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –º–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Ç–æ–º, —á—Ç–æ —Ç—ã –ø–∏—Ç–∞–µ—à—å—Å—è —Å–µ–≥–æ–¥–Ω—è. –ò–ª–∏ –≤ –Ω–∞—Å—Ç–æ–π–∫–∞—Ö –≤–∫–ª—é—á–∏ –æ—Ç–ø—Ä–∞–≤–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤.'}}. " +
            "*–≠—Ç–æ –≤–∞–∂–Ω–æ.*"
    },
    but_i_did_not_eat_today: [
        "*–¢—ã –ø–∏—Ç–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è.*\n\n" +
        "–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ —Ç–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ, —Ç–æ–≥–¥–∞, –≤–æ–∑–º–æ–∂–Ω–æ, –∫—Ç–æ-—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —Ç–≤–æ–µ–π –∫–∞—Ä—Ç–æ–π –ø–∏—Ç–∞–Ω–∏—è. " +
        "–†–∞—Å—Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º –∫–ª–∞—Å—Å–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é, –∏ –º—ã –ø–æ–ø—Ä–æ–±—É–µ–º –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —ç—Ç–æ.",
    ],
    but_i_did_not_eat_today_button: [
        "–ù–æ —è –Ω–µ –¥–µ–ª–∞–ª —ç—Ç–æ–≥–æ",
        "–ù–æ —è —Å–µ–≥–æ–¥–Ω—è –Ω–µ –ø–∏—Ç–∞–ª—Å—è"
    ],
    i_dont_understand: [
        "–≠–º–º, –∫–∞–∂–µ—Ç—Å—è, —è –Ω–µ –ø–æ–Ω–∏–º–∞—é —Ç–µ–±—è. –ù–µ –∑–∞–±—ã–≤–∞–π: —è –≤—Å–µ–≥–æ –ª–∏—à—å –±–æ—Ç.",
        "–ò–∑–≤–∏–Ω–∏, —è –Ω–µ –ø–æ–Ω—è–ª —Ç–µ–±—è. –Ø —É–º–µ—é –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã.",
        "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è —É–º–µ—é –ø–æ–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã."
    ],
    i_dont_understand_media: [
        "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —è –Ω–µ —É–º–µ—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è."
    ],
    you_have_been_unlinked: [
        "–ö—Ç–æ-—Ç–æ –ø—Ä–∏–≤—è–∑–∞–ª —Ç–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –∫ —Å–µ–±–µ —Å –ø–æ–º–æ—â—å—é –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞. " +
        "–¢–µ–ø–µ—Ä—å —è –Ω–µ —Å–º–æ–≥—É –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–≤–æ–∏ –∫–æ–º–∞–Ω–¥—ã. –ï—Å–ª–∏ —ç—Ç–æ —Å–¥–µ–ª–∞–ª –Ω–µ —Ç—ã, —Å–æ–æ–±—â–∏ –æ—Ç —ç—Ç–æ–º –∫–ª–∞—Å—Å–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é."
    ],
    help: [
        "{{'hello_message'|render}}\n" +
        "iosfvgneognvo"
    ]
}

export let question_keyboard = (yes_answer)=>Extra.markdown().markup((e)=>e.inlineKeyboard([
    e.callbackButton((yes_answer===true?"‚úÖ ":"")+"–î–∞", yes_answer?"none":"selected_yes"),
    e.callbackButton((yes_answer===false?"‚úÖ ":"")+"–ù–µ—Ç", !yes_answer?"none":"selected_no")
]));

import nunjucks from "nunjucks"
import isPlainObject from 'lodash/isPlainObject';
import isArray from 'lodash/isArray'
import random from 'lodash/random'
import merge from "lodash/merge";

let env = new nunjucks.Environment();

env.addFilter('render', function (name, data) {
    return getMessage(this.env.getGlobal('messenger'), name, data)
})
env.addFilter("capitalize_first", function (text) {
    text = text.split("");
    text[0] = text[0].toUpperCase();
    return text.join("");
})

export function getMessage(messenger, text_message_id, data) {
    let text = messages[text_message_id];
    if (!text) throw Error("–®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω " + text_message_id);
    if (isPlainObject(text)) {
        if (messenger)
            text = text[messenger];
        else text = text.vk;
    }
    if (isArray(text)) {
        let el = random(0, text.length - 1, false);
        text = text[el];
    }
    return env.renderString(text, data);
}

export function getCompileFunction(messenger) {
    env.addGlobal('messenger', messenger)
    return (text_message_id, data) => {
        return getMessage(messenger, text_message_id, data)
    }
}

export async function getStudent(ctx) {
    if (!ctx.session.student_id) return null;
    let student = await db.collection('students').doc(ctx.session.student_id).get();
    if (!student.exists) return null;
    //console.log(student);
    return student;
}

export function getStudentMenu(ctx) {
    let menu = ctx.state.settings.menu[ctx.state.student.eating_type];
    if (!menu) menu = getMessage(null, "no_menu");
    return menu;
}

export async function findStudent(invitation_code) {
    let student = await db.collection('students').where('invitation_code', '==', invitation_code).limit(1).get();
    if (student.empty) return null;
    return student.docs[0];
}

export function get_db_data(el) {
    return {
        _id: el.id,
        ...el.data()
    }
}

export async function linkTelegramStudentToSession(ctx, chat_id, student) {
    ctx.session.student_id = student.id;
    await notify_about_unlink(student);
    await student.ref.update({
        user_id: chat_id,
        bot_type: 'tg',
        last_message_id: null,
        last_sticker_message_id: null
    });
}

export async function linkVkStudentToSession(ctx, chat_id, student) {
    ctx.session.student_id = student.id;
    await notify_about_unlink(student);
    await student.ref.update({
        user_id: chat_id,
        bot_type: 'vk',
        last_message_id: null,
        last_sticker_message_id: null,
        //TODO use_old_client: true
    });
}

export async function unlinkStudentInSession(ctx, student) {
    ctx.session.student_id = undefined;
    await unlinkStudent(student);
}

export async function unlinkStudent(student) {

    await student.ref.update({
        user_id: null,
        bot_type: null,
        last_message_id: null,
        last_sticker_message_id: null,
        //TODO use_old_client: true
    });
}

export async function refreshStudent(ctx, check_link) {
    let student = await getStudent(ctx);
    if (!student) return null;
    if (!check_link(student.data(), ctx)) {
        ctx.session = {};
        return null;
    }
    ctx.state.studentRef = student;
    ctx.state.student = student.data();
    ctx.state.student._id = student.id;
    ctx.state.student.update = async (els) => {
        let res = await student.ref.update(els);
        ctx.state.student = merge(ctx.state.student, els);
        return res;
    }
}

export async function refreshSettings(ctx) {
    let settings = await db.collection("system").doc("settings").get();
    ctx.state.settingsRef = settings;
    ctx.state.settings = settings.data();
    ctx.state.settings.update = async (els) => {
        let res = await settings.ref.update(els);
        ctx.state.settings = merge(ctx.state.settings, els);
        return res;
    }
}

export async function getSettings() {
    let settings = await db.collection("system").doc("settings").get();
    if (!settings.exists) {
        return null;
    }
    let data = settings.data();
    data.raw = settings;
    data.update = async (els) => {
        let res = await settings.ref.update(els);
        merge(this, els);
        return this;
    }
    return data;
}

import tg from './tg_instance';
import vk from './vk_instance';
import Extra from "telegraf/extra";

export async function notify_about_unlink(st) {
    let student = st.data();
    if (student.bot_type === "tg") {
        await tg.telegram.sendMessage(student.user_id, getMessage('tg', "you_have_been_unlinked"));
    } else if (student.bot_type === "vk") {
        await vk.api.messages.send({
            user_id: student.user_id,
            message: getMessage('vk', "you_have_been_unlinked")
        })
    }
}